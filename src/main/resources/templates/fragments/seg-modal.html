<div th:fragment="content" class="seg-modal-container">
    <div class="mb-4">
        <h3 class="text-lg font-bold text-[var(--navy-blue)]">
            <i class="fas fa-hand-holding-usd mr-2 text-[var(--gold)]"></i>
            Recebimento da Seguradora
        </h3>
    </div>

    <div th:if="${successMessage}" class="mb-4 p-3 rounded border border-green-200 bg-green-50 text-green-800 text-sm">
        <span th:text="${successMessage}">Status atualizado</span>
    </div>

    <div th:if="${financeiroPendente == null}">
        <form class="space-y-3"
              th:attr="hx-post=@{/processos/etapa/{eid}/seguradora/salvar(eid=${etapa.id})}"
              hx-target="closest .seg-modal-container"
              hx-swap="outerHTML">
            <div class="mb-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">Valor a Receber</label>
                <input type="text" name="valorReceber" placeholder="Ex: 1500,00" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[var(--gold)] focus:border-[var(--gold)]">
                <p class="text-xs text-gray-500 mt-1">A etapa será marcada como concluída após o recebimento.</p>
            </div>
            <button type="submit" class="btn btn-primary">
                Salvar pendência
            </button>
        </form>
    </div>

    <div th:if="${financeiroPendente != null}">
        <form class="space-y-3"
              th:attr="hx-post=@{/processos/etapa/{eid}/seguradora/receber(eid=${etapa.id}, fid=${financeiroPendente.id})}"
              hx-target="closest .seg-modal-container"
              hx-swap="outerHTML">
            <div class="mb-3 p-3 bg-yellow-50 rounded border border-yellow-200">
                <p class="text-sm text-yellow-800">Pendente: <span th:text="${#numbers.formatCurrency(financeiroPendente.valor)}"></span></p>
                <p class="text-xs text-yellow-600">Ao confirmar, esta etapa será concluída na linha do tempo.</p>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">Data de Recebimento</label>
                <input type="date" name="dataRecebimento" th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-[var(--gold)] focus:border-[var(--gold)]">
            </div>
            <button type="submit" class="btn btn-success">
                Confirmar Recebimento e Concluir Etapa
            </button>
        </form>
    </div>

    <div class="mt-4 flex justify-end">
        <button type="button" class="btn btn-secondary" onclick="closeChecklistModal()">Fechar</button>
    </div>

    <div th:if="${hxOobSwap}">
        <div th:replace="~{fragments/timeline-view :: timeline}" hx-swap-oob="true"></div>
        <div th:replace="~{fragments/progress-bar :: progressBar(${processo})}" hx-swap-oob="true"></div>
    </div>
</div>
